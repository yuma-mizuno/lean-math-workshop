import Mathlib.Algebra.Algebra.Hom

namespace Tutorial

/- åœè«–ã§ã¯ã€ã„ã‚ã‚†ã‚‹å®‡å®™ã®æ‰±ã„ãŒå¿…è¦ã§ã‚ã‚‹ã€‚ãªã®ã§Leanã«ãŠã‘ã‚‹å®‡å®™ã®å–ã‚Šæ‰±ã„ã«
æœ€åˆã«èª¬æ˜ã‚’ã™ã‚‹ã€‚ã“ã®ã‚ˆã†ãªåŸºç¤ä»˜ã‘ã«èˆˆå‘³ãŒãªã„ã²ã¨ã¯åœã®å®šç¾©ã¾ã§èª­ã¿é£›ã°ã—ã¦ã‚‚
å•é¡Œãªã„ã€‚-/

/- # å‹ã®éšå±¤
Leanã«ãŠã„ã¦ã€Œ`X`ãŒé›†åˆã§ã‚ã‚‹ã€ã¨ã„ã„ãŸã„ã¨ãã¯`X : Type`ã¨æ›¸ãã€‚ã“ã‚Œã¯
ã€Œ`X`ã¯`Type`ã®é …ã§ã‚ã‚‹ã€ã‚‚ã—ãã¯ã€Œ`X`ã®å‹ã¯`Type`ã§ã‚ã‚‹ã€ã¨ã„ã†æ„å‘³ã§ã‚ã‚‹ã€‚
é›†åˆè«–çš„ã«ã„ãˆã°ã€`Type`ã¯ã™ã¹ã¦ã®é›†åˆã‹ã‚‰ãªã‚‹é›†åˆã§ã‚ã‚‹ã¨ã„ãˆã‚‹ã€‚ã—ã‹ã—ã€
ã‚ˆãçŸ¥ã‚‰ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã™ã¹ã¦ã®é›†åˆã‹ã‚‰ãªã‚‹é›†åˆã¯ç´ æœ´ã«ã¯å­˜åœ¨ã—ãªã„ã®ã§ã‚ã£ãŸã€‚
ã§ã¯ã€`Type`ã®å‹ã¯ãªã‚“ã§ã‚ã‚ã†ã‹ï¼Ÿ -/

#check Type

/- è¦‹ã¦ã‚ã‹ã‚‹ã‚ˆã†ã«ã€`Type`ã®å‹ã¯`Type 1`ã§ã‚ã‚‹ã€‚Leanã¯å¯ç®—ç„¡é™éšå±¤ã®å‹ã®åˆ—
`Type 0`, `Type 1`, `Type 2`,...ã‚’æŒã£ã¦ã„ã¦ã€`Type`ã¨ã¯å®Ÿã¯`Type 0`ã®ã“ã¨ã§ã‚ã‚‹ã€‚
Leanã§ã¯ã“ã®ã‚ˆã†ãªéšå±¤ã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã§ãƒ‘ãƒ©ãƒ‰ãƒƒã‚¯ã‚¹ã‚’å›é¿ã—ã¦ã„ã‚‹ã€‚-/

/- å®Ÿç”¨ä¸Šã¯ã€å‹ã®éšå±¤ã‚’å…·ä½“çš„ãªè‡ªç„¶æ•°ã‚’ä½¿ã£ã¦ã„ã˜ã‚‹ã“ã¨ã‚’ã¯ã»ã¨ã‚“ã©ãªã„ã€‚ä»£ã‚ã‚Šã«
å®‡å®™å¤‰æ•°ã¨ã„ã†ã‚‚ã®ã‚’ç”¨ã„ã‚‹ã€‚ã“ã‚Œã¯`universe`ã¨ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§å®£è¨€ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
Leanã¯çŠ¶æ³ã«å¿œã˜ã¦å®‡å®™å¤‰æ•°ã¸ã®å‰²ã‚Šå½“ã¦ã‚’è‡ªå‹•çš„ã«è¡Œã£ã¦ãã‚Œã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å‹ã®éšå±¤
ã«ã¤ã„ã¦æ³¨æ„ã‚’æ‰•ã†å¿…è¦ãŒãªã„ã“ã¨ãŒå¤šã„ã€‚-/

universe u v

/- # åœ -/

/- åœã®å®šç¾©ã¯é©šãã»ã©å˜ç´”ã«è¨˜è¿°ã§ãã‚‹ã€‚-/

class Category (C : Type u) where 
  Hom : C â†’ C â†’ Type v 
  comp : âˆ€ {a b c : C}, Hom a b â†’ Hom b c â†’ Hom a c
  id : âˆ€ (a : C), Hom a a
  id_comp : âˆ€ {a b : C} (f : Hom a b), comp (id a) f = f := by aesop
  comp_id : âˆ€ {a b : C} (f : Hom a b), comp f (id b) = f := by aesop
  assoc : âˆ€ {a b c d : C} (f : Hom a b) (g : Hom b c) (h : Hom c d), 
    comp (comp f g) h = comp f (comp g h) := by aesop

/- ä»¥é™ã€`[Category C]`ã¨æ›¸ãã“ã¨ã§é›†åˆ`C`ã«åœæ§‹é€ ã‚’è¼‰ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

å®šç¾©ã«é–¢ã—ã¦ã„ãã¤ã‹è£œè¶³ã‚’ã™ã‚‹ã€‚
* 2ã¤ã®å®‡å®™å¤‰æ•°`u, v`ã‚’ç”¨ã„ã¦ã„ã‚‹ã€‚`Type u`ã¯å¯¾è±¡å…¨ä½“ã®é›†åˆã®å±ã™ã‚‹éšå±¤ã€`Type v`ã¯Homé›†åˆã®å±ã™ã‚‹
  éšå±¤ã§ã‚ã‚‹ã€‚ä¾‹ãˆã°ã‚ˆãç¾ã‚Œã‚‹ã€Œå±€æ‰€å°ã€ã®è¨­å®šã¯`u > v`ï¼ˆå…¸å‹çš„ã«ã¯`u = v + 1`ï¼‰ã®å ´åˆã«ãŠãŠã‚ˆãå¯¾å¿œã™ã‚‹ã€‚
* `Hom`ã¯`a b : C`ã«å¯¾ã—ã¦Homé›†åˆ`Hom a b`ã‚’å®šç¾©ã—ã¦ã„ã‚‹ã€‚`Hom`ã®å‹ã®`C â†’ C â†’ Type v`ã¯`C â†’ (C â†’ Type v)`
  ã®ã“ã¨ã§ã‚ã‚Šã€ã—ãŸãŒã£ã¦`Hom`ã®é …ã¯ã€Œ`C`ã®é …ã«å¯¾ã—ã¦`C`ã‹ã‚‰`Type v`ã¸ã®é–¢æ•°ã‚’å¯¾å¿œã•ã›ã‚‹ã€é–¢æ•°ã§ã‚ã‚‹ã€‚
  `C â†’ C â†’ Type v`ã¯`C Ã— C â†’ Type v`ã¨æ•°å­¦çš„ã«ã¯ç­‰ä¾¡ã§ã‚ã‚‹ã€‚ã—ã‹ã—Leanã¯å¤šãã®å ´åˆã§å‰è€…ã®å½¢ã‚’å¥½ã‚€ã€‚
* 3ã¤ã®å…¬ç†ã®å¾Œã‚ã«ã¤ã„ã¦ã„ã‚‹`by aesop`ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã§ã‚ã‚‹ã€‚ã“ã‚Œã¯ã€åœã‚’æ§‹æˆã™ã‚‹éš›ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ
  å…¬ç†ã®è¨¼æ˜ã‚’æ›¸ã‹ãªã‹ã£ãŸå ´åˆã¯`aesop` tacticãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã‚’æ„å‘³ã™ã‚‹ã€‚åœè«–ã§ã¯`aesop`ãŒæˆåŠŸã™ã‚‹
  ã‚ˆã†ãªã€Œè‡ªæ˜ãªè¨¼æ˜ã€ãŒå¤šãã€ã“ã®ã‚ˆã†ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã‚’ç”¨ã„ãŸè‡ªå‹•åŒ–ãŒéå¸¸ã«æœ‰ç”¨ã§ã‚ã‚‹ã€‚tacicãŒå¤±æ•—ã—ãŸ
  å ´åˆã«ã¯ã‚¨ãƒ©ãƒ¼ãŒç”Ÿã˜ã‚‹ã€‚ã“ã®ã‚ˆã†ãªå ´åˆã«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ‰‹å‹•ã§è¨¼æ˜ã‚’åŸ‹ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚`aseop` tacticã«
  é–¢ã™ã‚‹è©³ç´°ã¯ https://github.com/JLimperg/aesop ã‚’å‚ç…§ã›ã‚ˆã€‚
-/

open Category

/-- `f : Hom a b`ã¨`g : Hom b c`ã®åˆæˆã‚’`f â‰« g`ã¨æ›¸ãã€‚
ã“ã®ã‚ˆã†ã«å·¦ã‹ã‚‰å³ã¨ã„ã†é †ã§åˆæˆã‚’æ›¸ãã“ã¨ã«ã™ã‚‹ã€‚-/
infixr:80 " â‰« " => Category.comp

/-- `a`ã«ãŠã‘ã‚‹æ’ç­‰å°„ã‚’`ğŸ™ a`ã¨æ›¸ãã€‚ -/
notation "ğŸ™" => Category.id

/- TIPS: `â‰«`ã‚„`ğŸ™`ãªã©ã®è¨˜å·ã®ä¸Šã«ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã‚’è¨˜å·ã®ä¸Šã«ä¹—ã›ã‚‹ã¨ã€å…¥åŠ›æ–¹æ³•ãŒã‚ã‹ã‚‹ã€‚-/

/- TIPS: ã“ã®æ™‚ç‚¹ã§ä¸Šè¨˜ã®åœã®å®šç¾©ã«ç¾ã‚Œã‚‹å…¬ç†ã‚’ç¢ºèªã™ã‚‹ã¨ã€ã„ã¾å®šç¾©ã—ãŸè¨˜å·ã‚’ä½¿ã£ã¦è¡¨ç¤ºã•ã‚Œã‚‹ã€‚ -/
#check id_comp
#check comp_id
#check assoc

/- å…¬ç†ã®ç­‰å¼ã‚’simpè£œé¡Œã«è¨­å®šã—ã¦ãŠã -/
attribute [simp] id_comp comp_id assoc

variable {C : Type u} [Category.{u, v} C] {a b c d e : C}

example (f : Hom a b) (g : Hom b c) (h : Hom c d) (i : Hom d e) : 
    (f â‰« (ğŸ™ b â‰« g)) â‰« (h â‰« i) = f â‰« (g â‰« ((ğŸ™ c â‰« h) â‰« i)) := by
  -- ãƒ’ãƒ³ãƒˆ: `simp`ã‚’ä½¿ãˆã°åœã®å…¬ç†ã‚’ä½¿ã£ã¦å¼ãŒç°¡ç•¥åŒ–ã•ã‚Œã‚‹
  sorry

example (f : Hom a b) (g : Hom b a) (hâ‚ hâ‚‚ : Hom b c) (Hgf : g â‰« f = ğŸ™ b) (Hfh : f â‰« hâ‚ = f â‰« hâ‚‚) : 
    hâ‚ = hâ‚‚ := by
  calc hâ‚ = ğŸ™ b â‰« hâ‚ := by simp
    _ = (g â‰« f) â‰« hâ‚ := by rw [Hgf]
    -- å¿…è¦ã«å¿œã˜ã¦è¡Œã‚’è¿½åŠ ã—ã‚ˆã†
    _ = hâ‚‚ := by sorry

/- # åœã®ä¾‹ -/

/-- å‹ã®åœã€‚Leanã«ãŠã‘ã‚‹ã€Œé›†åˆã®åœã€ã§ã‚ã‚‹ã€‚-/
instance : Category Type where 
  Hom X Y := X â†’ Y
  -- åˆæˆã®é †åºãŒé€†ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹
  comp f g := g âˆ˜ f
  id X := id
  /- å…¬ç†ã®è¨¼æ˜ã‚’æ›¸ã„ã¦ã„ãªã„ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ãªã„ã®ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã®`aesop`ãŒæˆåŠŸã—ã¦
  ã„ã‚‹ã“ã¨ã‚’æ„å‘³ã™ã‚‹ -/

/- TIPS: `pp.universes`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã€å®‡å®™ã‚’æ˜ç¤ºã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚-/
set_option pp.universes true in 
#check inferInstanceAs (Category Type)
/- å…ˆã»ã©å‹ã®åœã‚’å®šç¾©ã—ãŸéš›ã«ã¯åœã®å®‡å®™ã‚’æ˜ç¤ºã—ã¦ã„ãªã‹ã£ãŸã«ã‚‚é–¢ã‚ã‚‰ãšã€LeanãŒ
`u = 1`, `v = 0`ã¨ã„ã†å®‡å®™å¤‰æ•°ã®å‰²ã‚Šå½“ã¦ã‚’è¡Œã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã€‚ã“ã®ã‚ˆã†ã«ã€
å…·ä½“çš„ãªæ•°å­¦çš„å¯¾è±¡ã‚’æ‰±ã†éš›ã«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å®‡å®™ã®å¤§ãã•ã‚’æ°—ã«ã—ãªãã¦ã‚‚ã‚ˆã„ã“ã¨ãŒå¤šã„ã€‚ -/

@[simp]
theorem comp_app {X Y Z : Type} (f : Hom X Y) (g : Hom Y Z) (x : X) : (f â‰« g) x = g (f x) := by
  rfl

@[simp]
theorem id_app (X : Type) (x : X) : ğŸ™ X x = x := by
  rfl

/-- å¯æ›ç’°ã®åœ -/
structure CommRingCat where 
  /- ç’°ã¯ã€åº•é›†åˆã¨ãã®ä¸Šã®ç’°æ§‹é€ ã‹ã‚‰æˆã‚‹ã€‚-/
  base : Type
  /- mathlibã§ã¯å‹`R`ä¸Šã®ç’°æ§‹é€ ã®å‹ã‚’`CommRing R`ã§è¡¨ã™ï¼ˆãªã®ã§åœãã®ã‚‚ã®ã‚’`CommRing`ã¨æ›¸ã‘ãªã„...ï¼‰-/
  str : CommRing base

/- ãŠã¾ã˜ãªã„ã€‚`R : CommRingCat`ã«å¯¾ã—ã¦`a : R`ã¨æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚ -/
instance : CoeSort CommRingCat Type := âŸ¨fun R â†¦ R.baseâŸ© 
/- ãŠã¾ã˜ãªã„ã€‚`R : CommRingCat`ã«å¯¾ã—ã¦ã¯`R.base`ä¸Šã®ç’°æ§‹é€ ã¨ã—ã¦`R.str`ã‚’ç”¨ã„ã‚‹ã€‚ -/
instance (R : CommRingCat) : CommRing R.base := R.str

/- `CommRingCat`ãŒå®Ÿéš›ã«åœã¨ãªã‚‹ã“ã¨ã‚’ã¿ã¦ã¿ã‚ˆã†ã€‚-/

instance : Category CommRingCat where 
  -- å°„ã¯ç’°æº–åŒå‹
  Hom R S := RingHom R S
  -- åˆæˆã¨æ’ç­‰å°„ã‚’ä¸ãˆã‚‹
  comp f g := RingHom.comp g f
  id R := RingHom.id R
  /- ä»¥ä¸‹ã®å…¬ç†ã«ã¤ã„ã¦ã¯è¨¼æ˜ã‚’æ›¸ã„ã¦ã‚‚ã‚ˆã„ãŒã€çœç•¥ã—ã¦ã‚‚ã‚¨ãƒ©ãƒ¼ãŒã§ãªã„ã‹ã©ã†ã‹ã‚’ã¾ãšç¢ºèªã—ã¦ã¿ã‚ˆã†ã€‚
  ã‚‚ã—ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªã‘ã‚Œã°ã€ãã‚Œã¯`aesop`ãŒæˆåŠŸã—ãŸã“ã¨ã‚’æ„å‘³ã™ã‚‹ã€‚ -/
  id_comp := sorry
  comp_id := sorry
  assoc := sorry

/- æ¬¡ã¯å¯æ›ç’°`R`ã«å¯¾ã—ã¦`R`ä¸Šã®å¯æ›ä»£æ•°ã®åœã‚’å®šç¾©ã™ã‚‹ã€‚-/

/-- `R`ä¸Šã®å¯æ›ä»£æ•°ã®åœ -/
structure CommAlgCat (R : CommRingCat) where 
  -- åº•é›†åˆ
  base : Type
  -- åº•é›†åˆä¸Šã®å¯æ›ç’°ã®æ§‹é€ 
  ringStr : CommRing base
  -- åº•é›†åˆä¸Šã®`R`ä»£æ•°ã®æ§‹é€ 
  algStr : Algebra R base

variable {R : CommRingCat}

/- ãŠã¾ã˜ãªã„ -/
instance : CoeSort (CommAlgCat R) Type := âŸ¨fun M â†¦ M.baseâŸ© 
instance {M : CommAlgCat R} : CommRing M := M.ringStr
instance {M : CommAlgCat R} : Algebra R M := M.algStr

@[simps]
instance {R : CommRingCat} : Category (CommAlgCat R) where 
  Hom A B := AlgHom R A B
  comp f g := AlgHom.comp g f
  id A := AlgHom.id R A
  id_comp := sorry
  comp_id := sorry
  assoc := sorry

/- å®šç¾©ã®ä¸Šã®`@[simps]`ã¯ãŠã¾ã˜ãªã„ã§ã€ã“ã“ã§ã¯ç‰¹ã«æ„å‘³ãŒãªã„ã€‚`Lecture 2`ã§å½¹ã«ç«‹ã¤ã€‚ -/

-- ãŠã¾ã˜ãªã„ã€‚`Lecture 2`ã§å½¹ã«ç«‹ã¤ã€‚
instance {A B : CommAlgCat R} : AlgHomClass (Hom A B) R A B := 
  inferInstanceAs <| AlgHomClass (A â†’â‚[R] B) R A B

end Tutorial